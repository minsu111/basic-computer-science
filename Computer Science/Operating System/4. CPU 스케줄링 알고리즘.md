# CPU 스케줄링 알고리즘

## 개요

CPU 스케줄링과 알고리즘 개념 정리

## 주요 개념

- CPU 스케줄링 - 프로세스 우선순위와 스케줄링 큐
- CPU 스케줄링 알고리즘 - 비선점형 방식과 선점형 방식

---

## CPU 스케줄링이란?

CPU 스케줄링은 운영체제가 CPU 스케줄링 알고리즘에 따라 프로세스에서 해야 하는 일을 스레드 단위로 CPU에 할당하는 것을 말한다.
CPU 스케줄링 알고리즘에는 비선점형 방식과 선점형 방식이 있으며, 해당 알고리즘은 **CPU 이용률은 높게, 주어진 시간에는 많은 일을 하게, 준비 큐에 있는 프로세스는 적게, 응답 시간을 짧게** 설정하는 것을 목표로 한다.

### 프로세스 우선순위

모든 프로세스가 CPU를 차례대로 돌아가며 사용하는 것보다 프로세스가 요구하는 자원에 맞게 CPU를 배분하는 것이 더 효율적이다. → 그렇기 때문에 프로세스에는 실행 우선순위가 존재한다.

_e.g. I/O 바운드 프로세스는 CPU 바운드 프로세스의 우선순위보다 높다._

프로세스 우선순위는 PCB에 저장되고, **운영체제는 PCB를 기반으로 어떤 프로세스가 CPU를 얼마나 더 많이 사용하게 될건지 결정한다. **우선순위는 사용자가 직접 설정할 수도 있다.\*

### 스케줄링 큐

운영체제가 모든 프로세스의 PCB를 일일이 확인하면서 프로세스가 실행될 순서를 결정하는 건 비효율적이므로, 프로세스를 스케줄링 큐에 넣어 관리한다.

- 준비 큐 - 프로세스가 CPU를 이용하기 위해 기다리는 줄
- 대기 큐 - 입출력 요청을 받고 대기 상태에 접어든 프로세스들이 기다리는 줄

<br>
<img width="500" margin="10" alt="image" src="https://github.com/minsu111/basic-computer-science/assets/124219344/abc83567-7843-4958-bc6d-091bc6b08426">

---

## 비선점형 방식(non-preemptive)

비선점형 방식은 프로세스가 스스로 CPU 소유권을 포기하는 방식으로, 강제로 프로세스를 중지하지 않는다.
어느 한 프로세스가 CPU 소유권을 가지고 있는 상태라면 이 프로세스가 종료되거나 대기 상태에 접어들기 전까지는 다른 프로세스가 CPU를 사용할 수 없다.

그렇기 때문에 텍스트 스위칭(문맥 교환)으로 인한 부하가 적지만 모든 프로세스가 골고루 자원을 이용하기 어렵다.

### FCFS(First Come First Served)

- 준비 큐에 삽입된 순서 대로 처리(= 선입 선처리 스케줄링)
- 먼저 CPU를 요청한 프로세스부터 CPU를 할당함
- 단점: 프로세스들이 준비 큐에서 기다리는 시간이 매우 길어질 수 있음(호위 효과)
  - 앞에 실행 시간이 긴 프로세스가 처리될수록 뒤의 프로세스의 대기 시간이 길어짐

### SJF(Shortest Job First)

- CPU 사용 시간이 가장 짧은 프로세스부터 처리(= 최단 작업 우선 스케줄링)
- 장점: 호위 효과를 방지하고 평균 대기 시간이 가장 짧음
- 단점: CPU 사용 시간이 긴 프로세스가 실행되지 않는 현상(starvation)이 발생할 수 있음

### 우선순위

- 프로세스들에 우선순위를 부여하고, 우선순위가 높은 프로세스부터 처리
- 우선순위가 같을 경우 선입 선처리로 스케줄링됨
- SJF도 넓은 의미에서 우선순위 스케줄링으로 볼 수 있음
- 단점: 기아 현상(starvation)이 발생할 수 있음
  - 우선순위가 낮은 프로세스는 준비 큐에 먼저 삽입되었음에도 불구하고 실행이 무한정 연기될 수 있음
  - 이를 방지하기 위해 오랫동안 대기한 프로세스의 우선 순위를 점차 높이는 방식인 **에이징(aging)** 기법을 사용함

---

## 선점형 방식(preemptive)

선점형 방식은 정해진 시간만큼만 CPU를 사용하고 타임아웃 인터럽트가 발생하면 다른 프로세스에게 소유권을 넘겨준다.

그렇기 때문에 어느 한 프로세스의 자원 독점을 막고 프로세스들에 골고루 자원 배분가 가능하지만 그만큼 컨텍스트 스위칭으로 인한 부하가 발생할 수 있다.

### 라운드 로빈(RR - Round Robin)

- 선입 선처리 스케줄링과 타임 슬라이스(time slice) 개념이 더해진 방식
- 정해진 시간만큼만 돌아가면서 CPU를 사용
- 준비 큐에 삽입된 프로세스들은 정해진 시간만큼 순서 대로 CPU를 사용함
- 정해진 시간 동안 프로세스가 완료되지 않았다면 다시 큐의 맨 뒤에 삽입됨
- **타임 슬라이스의 크기가 중요함**
  - 너무 크면 → 사실상 FCFS와 같아져 호위 효과가 발생할 수 있음
  - 너무 작으면 → 컨텍스트 스위칭의 오버헤드 때문에 부하가 발생할 수 있음

### SRF(Shortest Remaining Time)

- SJF가 변형된 방식
- SJF는 중간에 실행 시간이 더 짧은 작업이 들어와도 기존에 실행 중인 프로세스가 작업을 모두 수행한 후 그 다음 짧은 작업을 이어나가는 반면, SRF는 중간에 더 짧은 작업이 들어오면 수행하던 프로세스를 중지하고 해당 프로세스를 수행함

### 다단계 큐(Multilevel queue)

- 우선순위 스케줄링의 바전된 형태
- 우선순위 별로 준비 큐를 여러 개 사용
  - 우선순위가 가장 높은 큐에 있는 프로세스 우선 처리
  - 우선순위가 가장 높은 큐가 비어 있으면 그 다음 우선순위 큐에 있는 프로세스 처리
- 장점: 프로세스 유형별로 우선순위를 구분하는 것이 쉬워짐
  - 큐 별로 스케줄링을 다르게 적용할 수 있음
- 단점: 큐 간의 프로세스 이동이 안되므로 기아 현상이 발생할 수 있음

## 이외 알고리즘

- **다단계 피드백 큐 스케줄링**
  - 다단계 큐 스케줄링의 단점을 보완함(큐 간 이동 가능)
  - 새롭게 준비 상태가 된 프로세스를 일단 가장 우선순위 높은 큐에 삽입하고, 정해진 타임 슬라이스만큼 실행되게 함
  - 이후 실행이 완료되지 않아 다시 준비 상태로 돌아오게 된다면 그 다음 우선순위 큐에 삽입
  - 위 과정을 반복함
    → CPU 집중 프로세스 우선순위는 상대적으로 점점 낮아지고 입출력 집중 프로세스의 우선순위는 상대적으로 점점 높아지게 됨
- **SRT(Shortest Remaining Time) - 최소 잔여 시간 우선 스케줄링**
  - 최단 작업 우선 스케줄링 + 라운드 로빈 스케줄링
  - 정해진 시간만큼 CPU를 이용하되, 다음으로 CPU를 사용할 프로세스로 남은 작업 시간이 가장 적은 프로세스가 선택됨

---

## 관련 용어 & 개념

- **I/O 바운드 프로세스**: 입출력 작업이 많은 프로세스(e.g. 비디오 재생, 디스크 백업, …)
- **CPU 바운드 프로세스**: CPU 작업이 많은 프로세스(e.g. 연산 작업, 그래픽 작업, …)
- **호위 효과(convoy effect)**: 모든 다른 프로세스들이 하나의 긴 프로세스가 CPU를 양도하기를 기다리는 것
- **타임 슬라이스(time slice)**: 각 프로세스가 CPU를 사용할 수 있는 정해진 시간

---

## 참고 자료

- [면접을 위한 CS 전공지식 노트(주홍철)](https://product.kyobobook.co.kr/detail/S000001834833?utm_source=google&utm_medium=cpc&utm_campaign=googleSearch&gt_network=g&gt_keyword=&gt_target_id=aud-901091942354:dsa-435935280379&gt_campaign_id=9979905549&gt_adgroup_id=132556570510&gad_source=1&gclid=Cj0KCQjwwYSwBhDcARIsAOyL0fhby9LTtW8HLZ5Wg0aW9oKf_EyHPNtAttNCtkeyvmU4HlWw4sGx6VYaAnT5EALw_wcB)
- [개발자를 위한 컴퓨터공학 1: 혼자 공부하는 컴퓨터구조 + 운영체제](https://www.inflearn.com/course/%ED%98%BC%EC%9E%90-%EA%B3%B5%EB%B6%80%ED%95%98%EB%8A%94-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/dashboard)
- 이미지 출처
  - [https://velog.io/@localgaji/CPU스케줄링](https://velog.io/@localgaji/CPU%EC%8A%A4%EC%BC%80%EC%A4%84%EB%A7%81)
